## Probes
![14.1 Probes.png](img/14.1%20Probes.png)

Когда мы стартуем прилу в кубе, нам надо как-то понимать состояние пода. Куб делает регулярно так называемые пробы:
- Liveness Probe - это некий хелсчек - живо/нет. Выполняется постоянно. В случае нецдачи рестартим под
- Readiness - проверка, а готова ли прила принимать траффик.Авполняется постоянно. Если неудача - то убираем под из балансировки
- Startup - проверяет запустилась ли прила. Исполняется только при старте. В это время Liveness и Readiness не выполняется, т.к. нет в этом смысла

Разберем наш деплоймент
[deployment-with-stuff.yaml](../practice/6.network-abstractions/1.probes/deployment-with-stuff.yaml)

Внутри появились настройки наших проб, описанные врнутри каждого контейнера. Каждый контейнер может иметь свой набор проб
```bash
        readinessProbe:
          failureThreshold: 3 #Количество попыток
          httpGet: #как выполянется проба. Еще могут быть exec - выполнить что-то внутри контейнера и tcp-socket - прсто турчаться в tcp сокет, и если он открыт и работает, то все окей. Успешные статус коды от 200 до 399
            path: /
            port: 80
          periodSeconds: 10 #Периодичность пробы
          successThreshold: 1 #Количество успещных попыток: которые сбросят счетчик failureThreshold
          timeoutSeconds: 1 #та1маут выполнения пробы
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /
            port: 80
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
          initialDelaySeconds: 10 #Это поле помогало ДО существования startupProbe. Теперь в нем нет нужды
        startupProbe:
          httpGet:
            path: /
            port: 80
          failureThreshold: 30
          periodSeconds: 10
```

задеплоим и получим поды
```bash
kubectl get pod                            
NAME                             READY   STATUS    RESTARTS   AGE
my-deployment-5ff9c994f5-rv5g5   0/1     Running   0          2s
my-deployment-5ff9c994f5-x57jt   0/1     Running   0          2s

NAME                             READY   STATUS    RESTARTS   AGE
my-deployment-5ff9c994f5-rv5g5   1/1     Running   0          11s
my-deployment-5ff9c994f5-x57jt   1/1     Running   0          11s
```
- READY 0/1 - значит, что readiness проба еще не прошла и наш контейнер еще не готов. 1/1 - все окей

Можно чекнуть логи:
```bash
kubectl logs my-deployment-5ff9c994f5-rv5g5  
```

Видим чек от куба ""kube-probe/1.34"
```bash
10.244.0.1 - - [01/Mar/2026:13:09:49 +0000] "GET / HTTP/1.1" 200 612 "-" "kube-probe/1.34" "-"
10.244.0.1 - - [01/Mar/2026:13:09:50 +0000] "GET / HTTP/1.1" 200 612 "-" "kube-probe/1.34" "-"
10.244.0.1 - - [01/Mar/2026:13:09:59 +0000] "GET / HTTP/1.1" 200 612 "-" "kube-probe/1.34" "-"
10.244.0.1 - - [01/Mar/2026:13:10:00 +0000] "GET / HTTP/1.1" 200 612 "-" "kube-probe/1.34" "-"
10.244.0.1 - - [01/Mar/2026:13:10:09 +0000] "GET / HTTP/1.1" 200 612 "-" "kube-probe/1.34" "-"
10.244.0.1 - - [01/Mar/2026:13:10:10 +0000] "GET / HTTP/1.1" 200 612 "-" "kube-probe/1.34" "-"
```


