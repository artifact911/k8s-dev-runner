## Downward Api
[deployment-with-downward-api.yaml](../practice/4.saving-configurations/4.downward/deployment-with-downward-api.yaml)

Позваляет передать приложения в контейнер некоторые параметры манифестов, 
например где запушен под, какой у него неймСпейс и др. 
Передать можно как переменные окрежения или как файлы

```bash
        - name: __NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: __POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: __POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: __POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: __NODE_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: __POD_SERVICE_ACCOUNT
          valueFrom:
            fieldRef:
              fieldPath: spec.serviceAccountName
```

Все пути можно посмотреть в доке куба, 
тут представлены только некоторые, но наиболее часто используемые.
Например,
- spec.nodeName - эти названия добавляются самим кубом
- metadata.name - вверху манифеста имя пода мы указываем

```bash
    volumeMounts:
        - name: config
          mountPath: /etc/nginx/conf.d/
        - name: podinfo
          mountPath: /etc/podinfo
      volumes:
      - name: config
        configMap:
          name: my-configmap
      - name: podinfo
        downwardAPI:
          items:
            - path: "labels"
              fieldRef:
                fieldPath: metadata.labels
            - path: "annotations"
              fieldRef:
                fieldPath: metadata.annotations
```
Тут, кроме ранее добавленного volumeMounts-config будет добавлен volumeMounts-podinfo. 
В каталог /etc/podinfo будем смотирован том типа downwardAPI. Далее мы говорим, что монтировать из
downwardAPI будем не все подряд, а только 2 раздела:
- labels - файл, в котором будут лежать все лейблы по пути metadata.labels
- annotations - файл с аннотациями. Аннотации - это костыль, передать какие-то настройки куба, которые 
еще не указаны в манифесте.

Катнем деплоймент (проверь СЕКРЕТ, если удалял)
```bash
kubectl apply -f /Users/half-life/Documents/artifact/projects/school-dev-k8s/practice/4.saving-configurations/2.secret/secret.yaml

kubectl apply -f deployment-with-downward-api.yaml 
```

подключимся в контейнер и посмотрим наш новый файлик
```bash
kubectl exec -it my-deployment-774684f57c-j7tsz -- bash 
cd /etc/podinfo
cat annotations
cat labels
```

видим
```bash
#cat annotations
kubernetes.io/config.seen="2026-02-24T19:50:41.804610375Z"
#cat labels
app="my-app"
```

Посмотрим переменные окружения и цвидим наши добавленные типа __NODE_NAM etc
```bash
kubectl exec -it my-deployment-774684f57c-j7tsz -- env
```
```bash
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=my-deployment-774684f57c-j7tsz
TERM=xterm
__POD_SERVICE_ACCOUNT=default
TEST=foo
TEST_1=updated
__NODE_NAME=minikube
__POD_NAME=my-deployment-774684f57c-j7tsz
__POD_NAMESPACE=default
__POD_IP=10.244.0.33
__NODE_IP=192.168.49.2
KUBERNETES_SERVICE_PORT=443
KUBERNETES_SERVICE_PORT_HTTPS=443
KUBERNETES_PORT=tcp://10.96.0.1:443
KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
KUBERNETES_PORT_443_TCP_PROTO=tcp
KUBERNETES_PORT_443_TCP_PORT=443
KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
KUBERNETES_SERVICE_HOST=10.96.0.1
NGINX_VERSION=1.12.2-1~stretch
NJS_VERSION=1.12.2.0.1.14-1~stretch
HOME=/root
```
