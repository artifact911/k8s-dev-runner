## Deployment
в файле описан создаваемый инстантс
[deployment.yaml](../practice/3.application-abstractions/3.deployment/deployment.yaml)

kubectl edit deploy - обратились к апи кубера, попросили описание деплоймента. Отредачим его, сохраним и выйдем,
это изменение попадет не в мой локльный файл, а полетит в куб и применится. Это хороши способ на ходу что-то менять
и дебажить, но плохой способ это делать на всех, т.к. непонятно, кто это накатил и зачем

открылся vim
- i - insert
- правим то что надо, как в обычном редакторе
- :wq - сохранить и выйти

Что произошло: У нас создался новый репликаСет и накатился вместе с новыми подами. А если мы сейчас получим rs,
то увидим две RS
```bash
my-deployment-84cdc578bb   0         0         0       25m
my-deployment-d9ffb897f    2         2         2       4m17s
```
Это произошло потому: что куб убивал один старый под и поднимал один новый. и так до тех пор, пока новых не стало
2 заявленных. Старый оставил потому, что мы может откатиться на него
```bash
kubectl rollout undo deployment my-deployment
```
Глубину отката можно регулировать в спеке деплоймента. По умолчанию revisionHistoryLimit=10

### Стратегия обновления

Можно реплики распределять как по штукам, так и по процентам

```bash
replicas: 2
#  стратегия обновления подов.
#  maxSurge - на сколько больше нормы подов мы можем поднять во время обновления
#  maxUnavailable - на сколько можем снизить. В данном случае будет так
strategy:
rollingUpdate:
#    можно сделать на 1 под больше запрошенного, во время rollingUpdate
      maxSurge: 1
#      нельзя опускать ни на один под во ремя обновления
      maxUnavailable: 0
```

При таком раскладе, у нас создастся +1 реплика и она будет новой - из станет три всего.
Затем прибхется 1 старая. Накатится снова +1 новая и убъется последняя старая

```bash
replicas: 2
strategy:
rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
```
При таком раскладе, у нас убъется 1 старая, создастся 2 новые и убъется последняя старая

```bash
replicas: 1
strategy:
rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
```
При таком раскладе, мы не получим даунТайм тогда, когдка конфиг будет таким.
Создасться +1 и затем убъется старая реплика